// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client" // no "*-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum UserRole {
  USER  @map("user")
  ADMIN @map("admin")
  DEV   @map("dev")
}

enum NoteStatus {
  DRAFT     @map("draft")
  PUBLISHED @map("published")
  TRASHED   @map("trashed")
}

// Model
model Profile {
  id          String    @id @default(uuid()) @db.Uuid
  email       String    @unique
  username    String?   @unique
  role        UserRole  @default(USER)
  displayName String?   @map("display_name")
  avatarUrl   String?   @map("avatar_url")
  themeMode   String    @default("dark") @map("theme_mode")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime? @updatedAt() @map("updated_at")

  note         Note[]
  notification Notification[]

  @@map("profiles")
}

model Note {
  id            String     @id @default(cuid())
  title         String?
  content       String?
  jsonContent   Json?
  color         String?
  edited        Boolean    @default(false)
  pinned        Boolean    @default(false)
  status        NoteStatus @default(DRAFT)
  numberOfEdits Int        @default(0) @map("number_of_edits")
  pinnedAt      DateTime?  @map("pinned_at")
  deletedAt     DateTime?  @map("deleted_at")
  createdAt     DateTime   @default(now()) @map("created_at")
  updatedAt     DateTime?  @updatedAt() @map("updated_at")
  userId        String     @map("user_id") @db.Uuid

  tags Tag[] @relation("NoteTags")

  user Profile @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notes")
}

model Notification {
  id        String   @id @default(cuid())
  type      String
  title     String
  message   String
  isRead    Boolean  @default(false) @map("is_read")
  createdAt DateTime @default(now()) @map("created_at")
  userId    String   @map("user_id") @db.Uuid

  user Profile @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notifications")
}

model Tag {
  id        String   @id @default(cuid())
  name      String
  createdAt DateTime @default(now()) @map("created_at")

  notes Note[] @relation("NoteTags")

  @@map("tags")
}
